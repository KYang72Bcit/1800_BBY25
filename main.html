<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>HealthGuard</title>
  <meta name="author" content="BBY25" />

  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!--Icon-->
  <link href="./images/favicon.ico" rel="icon" type="image/x-icon" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Hind&family=Oswald:wght@500&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&family=Oswald:wght@500&display=swap"
    rel="stylesheet" />
  
  
  
    <!-- Firebase 9 CDNs -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <!-- Link to the api keys for your firebase project -->
  <script src="./scripts/firebaseAPI.js"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />

  <!-- Own CSS Styles -->

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="./styles/style_index.css" />
  <link rel="stylesheet" href="./styles/style_main_V2.css" />

  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <!--Top Nav Bar-->
    <nav class="topnav">
      <div class="logo"></div>
      <!-- <span class="appname">HealthGuard</span> -->
      <i class="material-icons iphoto" style="font-size:30px;color:#7a7a7a">add_a_photo</i>
      <i class="material-icons iadd" style="font-size:30px;color:#7a7a7a">add_circle</i>
      <!--Hamberger menu & js to be included-->
      <a href="#" id="hamburgermenu">
        <i class="material-icons imenu" style="font-size:30px;color:#7a7a7a">menu</i>
      </a>
    </nav>
    <div id="menuLinks">
      <a href="#" class="insidemenu"><span>Information Centre</span></a>
      <a href="#" class="insidemenu"><span>Find Doctor Near Me</span></a>
      <a href="#" class="insidemenu"><span>App Settings</span></a>
    </div>
<!-- modal form -->
    <div class="modal" id="myModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Basic Information</h5>
            <button type="button" class="close" data-dismiss="myModal" aria-label="Close" onclick="closeModal()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="basicInfor">
         
              
              <div class="Gender">
                  <span>Gender</span>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="gender" id="inlineRadio1" value="Male">
                      <label class="form-check-label" for="inlineRadio1">Male</label>
                  </div>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="gender" id="inlineRadio2" value="Female">
                      <label class="form-check-label" for="inlineRadio2">Female</label>
                  </div>

              </div>

              <div class="input-div mb-3 yearOfBirth">
                  <label for="yearOfBirth" class="form-label">Year of Birth</label>
                  <input type="number" class="form-control yearOfBirth" id="yearOfBirth"  placeholder="1989" min="1900"
                      max="2021" required>
              </div>
              <div class="input-div mb-3 body_height">
                  <label for="body_height" class="form-label">Body Height (cm) </label>
                  <input type="number" class="form-control bodyHeight" id="bodyHeight" placeholder="160" min="50"
                      max="220" required>
              </div>

              <div class="input-div mb-3 body_weight">
                  <label for="body_weight" class="form-label">Body Weight (Kg) </label>
                  <input type="number" class="form-control bodyWeight" id="bodyWeight" placeholder="70" min="5"
                      max="200" required>
              </div>
              <div class="input-div onGoingCondition">
                  <label for="onGoingCondition" class="form-label">Ongong Condition</label>
                  <input class="form-control" list="Chronic_Diseases" placeholder="None" id="ongoingCondition" >
                  <datalist id="Chronic_Diseases">
                      <option value="None"></option>
                      <option value="ALS (Lou Gehrig's Disease)">ALS (Lou Gehrig's Disease)</option>
                      <option value="Alzheimer's Disease and other Dementias"></option>
                      <option value="Arthritis"></option>
                      <option value="Asthma"></option>
                      <option value="Cancer"></option>
                      <option value="Chronic Obstructive Pulmonary Disease (COPD)"></option>
                      <option value="Cystic Fibrosis"></option>
                      <option value="Diabetes"></option>
                      <option value="Eating Disorders"></option>
                      <option value="Heart Disease"></option>
                      <option value="Obesity"></option>
                      <option value="Oral Health"></option>
                      <option value="Osteoporosis"></option>
                      <option value="Reflex Sympathetic Dystrophy (RSD) Syndrome"></option>
                      <option value=" Tobacco Use and Related Conditions"></option>
                      <option value=" Prefer Not to Say"></option>

                  </datalist>
              </div>
              <div class="input-div familyHistory">
                  <label for="familyHistory" class="form-label">Family History</label>
                  <input class="form-control" list="Chronic_Diseases" placeholder="None" id="familyHistory" >
              </div>
             

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="basicInforSubmit">Save changes</button>
          </div>
          </form>
          </div>
        </div>
      </div>

    </div>


<!-- main page -->
    <div class="main">
      <img class="image" src="./profile.png" alt="profile image" />
      <div class="name">
        <span class="welcome">Welcome,</span><br />
        <span id="username"></span></div>
      <div class="personalinfo">
        <div class="info age"><span class="title">Age </span> <span id="age"></span></div>
        <div class="info gender"><span class="title">Gender </span><span id="gender"></span></div>
        <div class="info height"><span class="title">Height </span><span id="height"></span>cm</div>
        <div class="info weight"><span class="title">Weight </span><span id="weight"></span>kg</div>
        <div class="info condition"><span class="title">Ongoing condition </span><span id="user_ongoingCondition"></span></div>
        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#myModal">Update Basic Information</button>
      </div>
      <div class="schedule">
        <div class="upcoming">
          <i class="material-icons" style="color:black">event</i>
          Upcoming Due Dates
        </div>
        <div class="dental">
          <i class="material-icons iconcircle" style="color:#1783E8">circle</i>
          <span class="title2">Dental checkup</span>
          <span class="date dec">December 21, 2021</span>
        </div>
        <div class="blood">
          <i class="material-icons iconcircle" style="color:#c43b58">circle</i>
          <span class="title2">Blood tests</span>
          <span class="date apr">April 20, 2022</span>
        </div>
        <div class="health">
          <i class="material-icons iconcircle" style="color:#149E39">circle</i>
          <span class="title2">Health checkup</span>
          <span class="date nov">November 10, 2022</span>
        </div>
      </div>

    </div>
  </div>
  <div id="black">
  </div>


  <!--Bottom Nav Bar-->
  <footer class="bottomnav">
    <a href="./main.html" class="bottomicons bottom1">
      <i class="material-icons">home</i>
      <span>Home</span>
    </a>
    <a href="#" class="bottomicons bottom2">
      <i class="material-icons">event_available</i>
      <span>Schedule</span>
    </a>
    <a href="./testresults.html" class="bottomicons bottom3">
      <i class="material-icons">assignment</i>
      <span>Test Results</span>
    </a>
    <a href="./myProfile.html" class="bottomicons bottom4">
      <i class="material-icons">account_circle</i>
      <span>My Profile</span>
    </a>
  </footer>


  <!--------------------------------------------------->
  <!-- Your Javascript Libraries and scripts go here -->
  <!--------------------------------------------------->

  <script>
    //var currentUser;

    $(document).ready(function() {
     
      firebase.auth().onAuthStateChanged((user) => {
        // Check if user is signed in:
        if (user) {
          // Do something for the current logged-in user here:
          console.log("Checking if user is new:");
          //go to the correct user document by referencing to the user uid
          currentUser = db.collection("users").doc(user.uid);
          //get the document for current user.
          currentUser.get().then((userDoc) => {
            //get user information from document and stored in variables .

            var user_gender = userDoc.data().gender;
            // check if documents have that variables, assign the value to span with certain id. 
            console.log(user_gender);
            if (user_gender == null) {
              console.log("gender hasn't been set yet");
              $("#myModal").modal('show');
                console.log("Hi there, please fill out this form.");
            }
          });
        } else {
          // No user is signed in.
        }
      });

    });

    document.querySelector("#basicInfor").addEventListener('submit', submitForm);

            function submitForm(e) {
                e.preventDefault();

                 yearOfBirth = parseInt(getValuebyId("#yearOfBirth"));
                 bodyHeight = parseInt(getValuebyId("#bodyHeight"));
                 bodyWeight = parseInt(getValuebyId("#bodyWeight"));
                 ongoingCondition = getValuebyId("#ongoingCondition");
                 familyHistory = getValuebyId("#familyHistory");
                 gender = displayRadioValue();
                 
                 currentUser.update({
                   yearOfBirth: yearOfBirth,
                   bodyHeight: bodyHeight,
                   bodyWeight: bodyWeight,
                   ongoingCondition: ongoingCondition,
                   familyHistory: familyHistory,
                   gender: gender
                 }).then(() => {
                  console.log("Document successfully updated!");
                  location.reload();
                  $("#myModal").modal('hide');

                }).catch((error) => {
                    // The document probably doesn't exist.
                    console.error("Error updating document: ", error);
                });
                 
                 //window.location.assign("main.html");
                 
              }

    // close modal
    function closeModal() {
      $("#myModal").modal('hide');
    } 

    // display the value of radio butter of gender
    function displayRadioValue() {
          const ele = document.getElementsByName("gender");

          for (i = 0; i < ele.length; i++) {
            if (ele[i].checked) return ele[i].value;
          }
        }

    function getValuebyId(id) {
          return document.querySelector(id).value;
    }    

    // add unserGender to userdoc
    function writeGender() {
          firebase.auth().onAuthStateChanged((user) => {
            if (user) {
              currentUser = db.collection("users").doc(user.uid);
              currentUser.set({
                gender: displayRadioValue(),
              });
            }
          });
        }

    function getBasicInfor() {
      firebase.auth().onAuthStateChanged((user) => {
        // Check if user is signed in:
        if (user) {
          // Do something for the current logged-in user here:
          //console.log(user.uid);
          //go to the correct user document by referencing to the user uid
          currentUser = db.collection("users").doc(user.uid);
          //get the document for current user.
          currentUser.get().then((userDoc) => {
            //get user information from document and stored in variables .
            var user_Name = userDoc.data().name;
            var user_gender = userDoc.data().gender;
            var user_age = 2021 - userDoc.data().yearOfBirth;
            var user_bodyHeight = userDoc.data().bodyHeight;
            var user_bodyWeight = userDoc.data().bodyWeight;
            var user_ongoingCodition = userDoc.data().ongoingCondition;
            console.log(user_ongoingCodition);
            // check if documents have that variables, assign the value to span with certain id. 
            console.log(user_age);
            if (user_gender != null) {
              document.getElementById("gender").innerText = user_gender;
            }
            if (user_age != 0) {
              document.getElementById("age").innerText = user_age;
            }
            if (user_bodyHeight != 0) {
              document.getElementById("height").innerText = user_bodyHeight;
            }
            if (user_bodyWeight != 0) {
              document.getElementById("weight").innerText = user_bodyWeight;
            }
            if (user_ongoingCodition != null) {
              document.getElementById("user_ongoingCondition").innerText = user_ongoingCodition;
            }
            
            $("#username").text(user_Name); //using jquery
          });
        } else {
          // No user is signed in.
        }
      });
    }
    getBasicInfor();

    function getBasicInforModal() {
    var currentUser;
      firebase.auth().onAuthStateChanged((user) => {
        // Check if user is signed in:
        if (user) {
          // Do something for the current logged-in user here:
          //console.log(user.uid);
          //go to the correct user document by referencing to the user uid
          currentUser = db.collection("users").doc(user.uid);
          //get the document for current user.
          currentUser.get().then((userDoc) => {
            //get user information from document and stored in variables .
            var user_Name = userDoc.data().name;
            var user_gender = userDoc.data().gender;
            var user_yearOfBirth = userDoc.data().yearOfBirth;
            var user_bodyHeight = userDoc.data().bodyHeight;
            var user_bodyWeight = userDoc.data().bodyWeight;
            var user_ongoingCodition = userDoc.data().ongoingCondition;
            var user_familyHistory = userDoc.data().familyHistory;
            //console.log(user_ongoingCodition);
            // check if documents have that variables, assign the value to span with certain id. 
            //console.log(user_age);
            // if (user_Name != null) {
            //   document.getElementById("name").innerText = user_Name;
            // }
            if (user_gender != null) {
             checkRadioButton(user_gender);
            }
            if (user_yearOfBirth != 0) {
              document.getElementById("yearOfBirth").value = user_yearOfBirth;
            }
            if (user_bodyHeight != 0) {
              document.getElementById("bodyHeight").value = user_bodyHeight;
            }
            if (user_bodyWeight != 0) {
              document.getElementById("bodyWeight").value = user_bodyWeight;
            }
            if (user_ongoingCodition != null) {
              document.getElementById("ongoingCondition").value = user_ongoingCodition;
            }
            if (user_familyHistory != null) {
              document.getElementById("familyHistory").value = user_familyHistory;
            }
            
            $("#username").text(user_Name); //using jquery
          });
        } else {
          // No user is signed in.
        }
      });
    }
    getBasicInforModal();
    function checkRadioButton(user_gender){
        let buttons = document.querySelectorAll('input[name = "gender"]')
        console.log(buttons);
        //console.log("123");
        buttons.forEach(element =>{
            if(element.value === user_gender){
                console.log(element);
                element.checked = true
            }

        })
    }
  </script>
  <!--------------------------------------------------->
  <!------------ Your Javascript Libraries ------------>
  <!--------------------------------------------------->
  <script src="scripts/index.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


</body>

</html>